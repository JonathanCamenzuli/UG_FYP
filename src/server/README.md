# Server Source Code

This folder contains source code and scripts related to components running on the server.

Source code is available for the following containers:

- `coap-server` which is found in `./coap`
- `ip-lookup` which is found in `./ip_lookup`

## Environment

The server environment is based on a Raspberry Pi 4B, utilising Docker Containers.

Given that the server makes use of multiple containers, Docker Compose was used in order to define all containers and manage their deployment on the server.

To build the containers for the first time, one would only need to execute the `docker-build` script.

```bash
$ ./docker-build.sh
```

## Scripts

- Building Containers
    - `docker-build.ps1`, `docker-build.sh`: Used for building containers for the first time
    - `rebuild-coap-server.sh`: Used for rebuilding the CoAP Server only.
    - `rebuild-ip-lookup.sh`: Used for rebuilding the IP Lookup Server only.
- Opening Container Logs
    - `open-coap-logs.sh`: Used for opening logs from the CoAP Server
    - `open-ip-lookup-logs.sh`: Used for opening logs from the IP Lookup Server

## External Docker Images

In this folder, two `env_files` are used for the `docker-compose.yaml`. They are not available in the public repo.

### InfluxDB (`influxdb.env`)

The following environment variables are used in `influxdb.env`:

```.env
DOCKER_INFLUXDB_INIT_MODE="setup"
DOCKER_INFLUXDB_DB                  # The name of the database
DOCKER_INFLUXDB_INIT_USERNAME       # The username to set for the system's initial super-user (Required)
DOCKER_INFLUXDB_INIT_PASSWORD       # The password to set for the system's inital super-user (Required)
DOCKER_INFLUXDB_INIT_ORG            # The name to set for the system's initial organization (Required)
DOCKER_INFLUXDB_INIT_BUCKET         # The name to set for the system's initial bucket (Required)
DOCKER_INFLUXDB_INIT_RETENTION      # The duration the system's initial bucket should retain data. If not set, the initial bucket will retain data forever.
DOCKER_INFLUXDB_INIT_ADMIN_TOKEN    # The authentication token to associate with the system's initial super-user. If not set, a token will be auto-generated by the system.
```

### Grafana (`grafana.env`)

The following environment variables are used in `grafana.env`:

```.env
GF_SECURITY_ADMIN_USER              # Username
GF_SECURITY_ADMIN_PASSWORD          # Password
GF_SERVER_HTTP_PORT="3001"          # HTTP Port
```
